import{trapFocus,scrollToTop}from"./utils.js";let lastFocusedElement=null;export function initHeader(){const e=document.getElementById("page-header");if(!e)return;function t(){window.pageYOffset>20?e.classList.add("scrolled"):e.classList.remove("scrolled")}window.addEventListener("scroll",t,{passive:!0}),t();const o=e.querySelectorAll(".nav-item");o.length>0&&setTimeout(()=>{o.forEach(e=>e.classList.add("loaded"))},1200)}export function initSmoothNavigation(){const e=document.querySelectorAll(".nav-item, .skip-link"),t=document.querySelector(".header-logo");e.forEach(e=>{e.addEventListener("click",t=>{const o=e.getAttribute("href");if("#main"===o)return t.preventDefault(),window.history.pushState("",document.title,window.location.pathname+window.location.search),void window.scrollTo({top:0,behavior:"smooth"});if(o&&o.startsWith("#")){t.preventDefault();const e=o.substring(1),n=document.getElementById(e);n&&(window.history.pushState(null,null,o),n.scrollIntoView({behavior:"smooth",block:"start"}))}})}),t&&t.addEventListener("click",e=>{const o=t.getAttribute("href");o!==window.location.origin+window.location.pathname&&o!==window.location.origin&&"/"!==o||(e.preventDefault(),window.history.pushState("",document.title,window.location.pathname+window.location.search),window.scrollTo({top:0,behavior:"smooth"}))}),window.addEventListener("popstate",()=>{const e=window.location.hash;if(e){const t=document.querySelector(e);t&&t.scrollIntoView({behavior:"smooth",block:"start"})}else window.scrollTo({top:0,behavior:"smooth"})})}export function initMobileMenu(){const e=document.getElementById("mobileMenuToggle"),t=document.getElementById("mobileMenuOverlay"),o=document.querySelectorAll(".mobile-menu-overlay .nav__link");if(!e||!t)return;const n=()=>{e.classList.remove("active"),t.classList.remove("active"),document.body.classList.remove("menu-open"),e.setAttribute("aria-expanded","false")};e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();e.classList.contains("active")?n():(e.classList.add("active"),t.classList.add("active"),document.body.classList.add("menu-open"),e.setAttribute("aria-expanded","true"))}),t.addEventListener("click",e=>{e.target===t&&n()}),o.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const o=e.getAttribute("href");n(),setTimeout(()=>{if("#main"===o)return window.history.pushState("",document.title,window.location.pathname+window.location.search),void window.scrollTo({top:0,behavior:"smooth"});if(o&&o.startsWith("#")){const e=o.substring(1),t=document.getElementById(e);t&&(window.history.pushState(null,null,o),t.scrollIntoView({behavior:"smooth",block:"start"}))}},100)})}),document.addEventListener("keydown",e=>{"Escape"===e.key&&t.classList.contains("active")&&n()})}export function initScrollProgress(){const e=document.getElementById("scrollProgress");e&&window.addEventListener("scroll",()=>{const t=(window.pageYOffset||document.documentElement.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100;e.style.width=t+"%"},{passive:!0})}export function initCertModal(){document.addEventListener("click",e=>{const o=e.target.closest(".cert-badge");o&&t(o.dataset.certTitle,o.dataset.certDesc,o.dataset.certLevel,o.dataset.certYear,o.dataset.certIcon)});const e=document.getElementById("certModal");if(e){e.addEventListener("click",e=>{"certModal"===e.target.id&&o()});const t=e.querySelector(".cert-modal-close");t&&t.addEventListener("click",o)}function t(e,t,o,n,s){lastFocusedElement=document.activeElement;const c=document.getElementById("certModal");document.getElementById("certModalTitle").textContent=e,document.getElementById("certModalDesc").textContent=t,document.getElementById("certModalLevel").textContent=o,document.getElementById("certModalYear").textContent=n,document.getElementById("certModalIcon").className=`cert-modal-icon ${s}`,c.classList.add("active"),c.setAttribute("aria-hidden","false"),trapFocus(c),setTimeout(()=>{const e=c.querySelector(".cert-modal-close");e&&e.focus()},100)}function o(){const e=document.getElementById("certModal");e.classList.remove("active"),e.setAttribute("aria-hidden","true"),lastFocusedElement&&(lastFocusedElement.focus(),lastFocusedElement=null)}window.openCertModal=t,window.closeCertModal=o}export function initStickyCTA(){const e=document.getElementById("stickyCta");e&&window.addEventListener("scroll",()=>{window.pageYOffset>800?e.classList.add("show"):e.classList.remove("show")},{passive:!0})}export function initBackToTop(){const e=document.getElementById("backToTop");e&&(window.addEventListener("scroll",()=>{window.pageYOffset>300?e.classList.add("show"):e.classList.remove("show")},{passive:!0}),e.addEventListener("click",()=>{scrollToTop()}))}export function hideLoadingScreen(){const e=document.getElementById("loading-screen");if(!e)return;const t=()=>{e.classList.add("hidden"),setTimeout(()=>e.remove(),400)},o=Date.now(),n=()=>{const e=Date.now()-o,n=Math.max(0,500-e);setTimeout(t,n)};"complete"===document.readyState?n():window.addEventListener("load",n,{once:!0})}export function initModalEscapeHandler(){document.addEventListener("keydown",e=>{if("Escape"===e.key){const e=document.getElementById("certModal"),t=document.getElementById("projectModal");e&&e.classList.contains("active")&&window.closeCertModal(),t&&t.classList.contains("active")&&window.closeProjectModal()}})}