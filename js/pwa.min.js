let deferredPrompt=null,installPromptShown=!1;export function initPWA(){window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),deferredPrompt=t,installPromptShown||isAppInstalled()||setTimeout(showInstallPrompt,3e4)}),window.addEventListener("appinstalled",()=>{console.log("PWA installed successfully"),deferredPrompt=null,hideInstallPrompt(),localStorage.setItem("pwa-installed","true")}),localStorage.getItem("pwa-prompt-dismissed")}function isAppInstalled(){return!!window.matchMedia("(display-mode: standalone)").matches||"true"===localStorage.getItem("pwa-installed")}function showInstallPrompt(){if(!deferredPrompt||installPromptShown)return;installPromptShown=!0;document.body.insertAdjacentHTML("beforeend",'\n    <div class="pwa-install-prompt" id="pwaInstallPrompt" role="dialog" aria-labelledby="pwaPromptTitle">\n      <div class="pwa-prompt-content">\n        <button class="pwa-prompt-close" id="pwaPromptClose" aria-label="Close install prompt">Ã—</button>\n        <div class="pwa-prompt-icon">ðŸ“±</div>\n        <h3 id="pwaPromptTitle">Install CloudyCode.dev</h3>\n        <p>Add to your home screen for quick access and offline support</p>\n        <div class="pwa-prompt-actions">\n          <button class="pwa-btn pwa-btn-primary" id="pwaInstallBtn">Install</button>\n          <button class="pwa-btn pwa-btn-secondary" id="pwaDismissBtn">Not Now</button>\n        </div>\n      </div>\n    </div>\n  '),setTimeout(()=>{const t=document.getElementById("pwaInstallPrompt"),e=document.getElementById("pwaInstallBtn"),n=document.getElementById("pwaDismissBtn"),o=document.getElementById("pwaPromptClose");t&&t.classList.add("show"),e&&e.addEventListener("click",handleInstall),n&&n.addEventListener("click",()=>dismissPrompt(!1)),o&&o.addEventListener("click",()=>dismissPrompt(!1))},100)}async function handleInstall(){if(!deferredPrompt)return;deferredPrompt.prompt();const{outcome:t}=await deferredPrompt.userChoice;console.log(`User ${t} the install prompt`),dismissPrompt("accepted"===t),deferredPrompt=null}function dismissPrompt(t=!1){const e=document.getElementById("pwaInstallPrompt");if(e&&(e.classList.remove("show"),setTimeout(()=>e.remove(),300)),!t){const t=Date.now()+6048e5;localStorage.setItem("pwa-prompt-dismissed",t)}}function hideInstallPrompt(){const t=document.getElementById("pwaInstallPrompt");t&&(t.classList.remove("show"),setTimeout(()=>t.remove(),300))}export function initSWUpdateNotification(){if(!("serviceWorker"in navigator))return;let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{if(t)return;t=!0;document.body.insertAdjacentHTML("beforeend",'\n      <div class="sw-update-notification" id="swUpdateNotification">\n        <div class="sw-update-content">\n          <i class="fas fa-sync-alt sw-update-icon"></i>\n          <p>New version available!</p>\n          <div class="sw-update-actions">\n            <button class="sw-update-btn sw-update-btn-primary" onclick="window.location.reload()">Refresh Now</button>\n            <button class="sw-update-btn sw-update-btn-close" id="swUpdateClose">Ã—</button>\n          </div>\n        </div>\n      </div>\n    '),setTimeout(()=>{const t=document.getElementById("swUpdateNotification");t&&t.classList.add("show")},100);const e=document.getElementById("swUpdateClose");e&&e.addEventListener("click",()=>{const t=document.getElementById("swUpdateNotification");t&&(t.classList.remove("show"),setTimeout(()=>t.remove(),300))}),setTimeout(()=>{const t=document.getElementById("swUpdateNotification");t&&t.classList.contains("show")&&(t.classList.remove("show"),setTimeout(()=>t.remove(),300))},15e3)})}